<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">
<head>
    <title>ë©”ì¸ í˜ì´ì§€</title>
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <th:block layout:fragment="css">
        <style>
            /* í°íŠ¸ ì ìš© */
            body {
                font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
            }

            /* ìºëŸ¬ì…€ ì»¨í…Œì´ë„ˆ: ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            .custom-carousel-wrapper {
                border-radius: 24px;
                overflow: hidden;
                position: relative;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .carousel-item {
                position: relative;
                height: 380px; /* ë†’ì´ ê³ ì • (ì´ë¯¸ì§€ ë¹„ìœ¨ì— ë§ê²Œ ì¡°ì • ê°€ëŠ¥) */
                background-color: #2c2c2c; /* ì´ë¯¸ì§€ê°€ ì—†ì„ ë•Œ ë°°ê²½ìƒ‰ */
            }

            .carousel-item img {
                height: 100%;
                width: 100%;
                object-fit: cover;
                /* ì´ë¯¸ì§€ ìì²´ì— ê·¸ë¼ë°ì´ì…˜ì´ ìˆë‹¤ë©´ ì´ëŒ€ë¡œ, ì—†ë‹¤ë©´ overlay ì¶”ê°€ í•„ìš” */
            }

            /* í…ìŠ¤íŠ¸ ìº¡ì…˜ ìœ„ì¹˜ ë° ìŠ¤íƒ€ì¼ */
            .custom-caption {
                position: absolute;
                top: 50%;
                left: 60px;
                transform: translateY(-50%);
                text-align: left;
                color: white;
                z-index: 10;
                max-width: 600px;
            }

            .custom-caption h2 {
                font-size: 36px;
                font-weight: 700;
                margin-bottom: 12px;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }

            .custom-caption p {
                font-size: 16px;
                font-weight: 400;
                opacity: 0.9;
                margin-bottom: 0;
                text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            }

            /* ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ (ì¢Œì¸¡ í•˜ë‹¨) */
            .custom-controls {
                position: absolute;
                bottom: 40px;
                left: 60px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 20;
            }

            /* í˜ì´ì§€ ì¹´ìš´í„° (ìº¡ìŠí˜•) */
            .carousel-counter {
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 20px;
                height: 36px;
                display: flex;
                align-items: center;
                padding: 0 16px;
                font-size: 14px;
                font-weight: 600;
                color: #333;
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            }
            
            .control-btn {
                background: none;
                border: none;
                cursor: pointer;
                padding: 0 8px;
                font-size: 16px;
                color: #333;
                display: flex;
                align-items: center;
            }
            .control-btn:hover {
                color: #000;
            }

            .counter-text {
                margin: 0 4px;
                font-variant-numeric: tabular-nums; /* ìˆ«ì ë„ˆë¹„ ê³ ì • */
            }

            /* ì „ì²´ë³´ê¸° ë²„íŠ¼ (ì›í˜•) */
            .menu-btn {
                width: 36px;
                height: 36px;
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
                border: none;
                color: #333;
            }
            .menu-btn:hover {
                background-color: #fff;
            }

            /* ê¸°ë³¸ í™”ì‚´í‘œ ìˆ¨ê¸°ê¸° */
            .carousel-control-prev, .carousel-control-next {
                display: none; 
            }
        </style>
    </th:block>
</head>
<main layout:fragment="content">
    
    <!-- ì»¤ìŠ¤í…€ ìºëŸ¬ì…€ -->
    <div class="custom-carousel-wrapper">
        <div id="homeCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
            
            <div class="carousel-inner">
                <div th:each="item, stat : ${carouselItems}"
                     class="carousel-item"
                     th:classappend="${stat.first} ? 'active'"
                     data-bs-interval="5000">
                    <img th:src="@{${item.imageUrl}}" alt="Carousel Image">
                    
                    <!-- í…ìŠ¤íŠ¸ ìº¡ì…˜ -->
                    <div class="custom-caption">
                        <h2 th:text="${item.title}">í™˜ì˜ì´ ë‚´ë¦¬ëŠ” ë°¤ ì´ë²¤íŠ¸</h2>
                        <p th:text="${item.description}">2025ë…„ 12ì›” 18ì¼(ëª©) ì ê²€ í›„ ~ 2026ë…„ 3ì›” 18ì¼(ìˆ˜) ì˜¤í›„ 11ì‹œ 59ë¶„</p>
                    </div>
                </div>
            </div>

            <!-- ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ -->
            <div class="custom-controls">
                <!-- í˜ì´ì§€ ì¹´ìš´í„° -->
                <div class="carousel-counter">
                    <button class="control-btn" type="button" data-bs-target="#homeCarousel" data-bs-slide="prev">
                        &lt;
                    </button>
                    <span class="counter-text">
                        <span id="currentSlide">1</span> / <span id="totalSlides" th:text="${#lists.size(carouselItems)}">0</span>
                    </span>
                    <button class="control-btn" type="button" data-bs-target="#homeCarousel" data-bs-slide="next">
                        &gt;
                    </button>
                </div>

                <!-- ì „ì²´ë³´ê¸° ë©”ë‰´ ë²„íŠ¼ (ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„, ì•„ì´ì½˜ í‘œì‹œ) -->
                <button class="menu-btn" title="ì „ì²´ë³´ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                </button>
            </div>

        </div>
    </div>
    <!-- ìºëŸ¬ì…€ ë -->

    <!-- ì¸ê¸° ìƒí’ˆ ì„¹ì…˜ (ì¶”ê°€) -->
    <div th:if="${popularProducts != null and not #lists.isEmpty(popularProducts)}" class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0 fw-bold">ì§€ê¸ˆ í•«í•œ ìƒí’ˆ ğŸ”¥</h4>
            <!-- ë”ë³´ê¸° ë§í¬ëŠ” ì „ì²´ ìƒí’ˆ ëª©ë¡ìœ¼ë¡œ ì´ë™ (ì¶”í›„ ì¸ê¸° ìƒí’ˆ ë”ë³´ê¸° í˜ì´ì§€ í•„ìš” ì‹œ ì—°ê²°) -->
            <a th:href="@{/products}" class="text-decoration-none text-muted" style="font-size: 0.9rem;">ë”ë³´ê¸° &gt;</a>
        </div>
        
        <div class="popular-products-container" style="display: flex; overflow-x: auto; gap: 1rem; padding-bottom: 1rem;">
            <div th:each="product : ${popularProducts}" class="product-item-card border shadow-sm">
                <a th:href="@{/products/{id}(id=${product.id})}" class="text-decoration-none text-dark">
                    <div class="product-img-container">
                        <img th:if="${!#lists.isEmpty(product.storedFileNames)}" 
                             th:src="@{/images/{filename}(filename=${product.storedFileNames[0]})}" 
                             alt="ìƒí’ˆ ì´ë¯¸ì§€">
                        <img th:unless="${!#lists.isEmpty(product.storedFileNames)}" 
                             th:src="@{/image/placeholder.png}" 
                             alt="ì´ë¯¸ì§€ ì—†ìŒ">
                        
                        <!-- ì¡°íšŒìˆ˜ ë±ƒì§€ (ê¸°ëŠ¥ìƒ í•„ìš”í•˜ë¯€ë¡œ ìœ ì§€) -->
                        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.6); color: #fff; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem;">
                            ğŸ‘€ <span th:text="${product.views}">0</span>
                        </div>
                    </div>
                    
                    <div class="product-card-body">
                        <div class="product-card-title" th:text="${product.title}">ìƒí’ˆ ì œëª©</div>
                        <div class="product-card-price" th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')} + 'ì›'">10,000ì›</div>
                        <div class="product-card-region" th:text="${product.dealRegion}">ì„œìš¸ ê°•ë‚¨êµ¬</div>
                    </div>
                </a>
            </div>
        </div>
        
        <style>
            .popular-products-container::-webkit-scrollbar { height: 6px; }
            .popular-products-container::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 3px; }
            .popular-products-container::-webkit-scrollbar-track { background: transparent; }
        </style>
    </div>

    <!-- êµ¬ë¶„ì„  -->
    <hr class="section-divider" style="border-top: 1px solid #eee; margin: 40px 0;"/>

    <!-- ìµœê·¼ ë³¸ ìƒí’ˆ ëª©ë¡ í”„ë˜ê·¸ë¨¼íŠ¸ ì‚½ì… -->
    <div th:replace="~{fragments/recent_products :: recentProductsFragment}"></div>

    <!-- ìŠ¤í¬ë¦½íŠ¸: í˜ì´ì§€ ì¹´ìš´í„° ì—…ë°ì´íŠ¸ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var myCarousel = document.getElementById('homeCarousel');
            var currentSlideEl = document.getElementById('currentSlide');
            
            // Bootstrap carousel ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            myCarousel.addEventListener('slid.bs.carousel', function (event) {
                // event.toëŠ” 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
                currentSlideEl.textContent = event.to + 1;
            });
        });
    </script>
</main>
</html>