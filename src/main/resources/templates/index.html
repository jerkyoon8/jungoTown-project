<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">
<head>
    <title>메인 페이지</title>
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <th:block layout:fragment="css">
        <style>
            /* 폰트 적용 */
            body {
                font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, sans-serif;
            }

            /* 캐러셀 컨테이너: 둥근 모서리 */
            .custom-carousel-wrapper {
                border-radius: 24px;
                overflow: hidden;
                position: relative;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .carousel-item {
                position: relative;
                height: 380px; /* 높이 고정 (이미지 비율에 맞게 조정 가능) */
                background-color: #2c2c2c; /* 이미지가 없을 때 배경색 */
            }

            .carousel-item img {
                height: 100%;
                width: 100%;
                object-fit: cover;
                /* 이미지 자체에 그라데이션이 있다면 이대로, 없다면 overlay 추가 필요 */
            }

            /* 텍스트 캡션 위치 및 스타일 */
            .custom-caption {
                position: absolute;
                top: 50%;
                left: 60px;
                transform: translateY(-50%);
                text-align: left;
                color: white;
                z-index: 10;
                max-width: 600px;
            }

            .custom-caption h2 {
                font-size: 36px;
                font-weight: 700;
                margin-bottom: 12px;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }

            .custom-caption p {
                font-size: 16px;
                font-weight: 400;
                opacity: 0.9;
                margin-bottom: 0;
                text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            }

            /* 커스텀 컨트롤러 (좌측 하단) */
            .custom-controls {
                position: absolute;
                bottom: 40px;
                left: 60px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 20;
            }

            /* 페이지 카운터 (캡슐형) */
            .carousel-counter {
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 20px;
                height: 36px;
                display: flex;
                align-items: center;
                padding: 0 16px;
                font-size: 14px;
                font-weight: 600;
                color: #333;
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            }
            
            .control-btn {
                background: none;
                border: none;
                cursor: pointer;
                padding: 0 8px;
                font-size: 16px;
                color: #333;
                display: flex;
                align-items: center;
            }
            .control-btn:hover {
                color: #000;
            }

            .counter-text {
                margin: 0 4px;
                font-variant-numeric: tabular-nums; /* 숫자 너비 고정 */
            }

            /* 전체보기 버튼 (원형) */
            .menu-btn {
                width: 36px;
                height: 36px;
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 2px 6px rgba(0,0,0,0.15);
                border: none;
                color: #333;
            }
            .menu-btn:hover {
                background-color: #fff;
            }

            /* 기본 화살표 숨기기 */
            .carousel-control-prev, .carousel-control-next {
                display: none; 
            }
        </style>
    </th:block>
</head>
<main layout:fragment="content">
    
    <!-- 커스텀 캐러셀 -->
    <div class="custom-carousel-wrapper">
        <div id="homeCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
            
            <div class="carousel-inner">
                <div th:each="item, stat : ${carouselItems}"
                     class="carousel-item"
                     th:classappend="${stat.first} ? 'active'"
                     data-bs-interval="5000">
                    <img th:src="@{${item.imageUrl}}" alt="Carousel Image">
                    
                    <!-- 텍스트 캡션 -->
                    <div class="custom-caption">
                        <h2 th:text="${item.title}">환영이 내리는 밤 이벤트</h2>
                        <p th:text="${item.description}">2025년 12월 18일(목) 점검 후 ~ 2026년 3월 18일(수) 오후 11시 59분</p>
                    </div>
                </div>
            </div>

            <!-- 커스텀 컨트롤러 -->
            <div class="custom-controls">
                <!-- 페이지 카운터 -->
                <div class="carousel-counter">
                    <button class="control-btn" type="button" data-bs-target="#homeCarousel" data-bs-slide="prev">
                        &lt;
                    </button>
                    <span class="counter-text">
                        <span id="currentSlide">1</span> / <span id="totalSlides" th:text="${#lists.size(carouselItems)}">0</span>
                    </span>
                    <button class="control-btn" type="button" data-bs-target="#homeCarousel" data-bs-slide="next">
                        &gt;
                    </button>
                </div>

                <!-- 전체보기 메뉴 버튼 (기능은 추후 구현, 아이콘 표시) -->
                <button class="menu-btn" title="전체보기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                </button>
            </div>

        </div>
    </div>
    <!-- 캐러셀 끝 -->

    <!-- 구분선 -->
    <hr class="section-divider" style="border-top: 1px solid #eee; margin: 40px 0;"/>

    <!-- 최근 본 상품 목록 프래그먼트 삽입 -->
    <div th:replace="~{fragments/recent_products :: recentProductsFragment}"></div>

    <!-- 스크립트: 페이지 카운터 업데이트 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var myCarousel = document.getElementById('homeCarousel');
            var currentSlideEl = document.getElementById('currentSlide');
            
            // Bootstrap carousel 이벤트 리스너
            myCarousel.addEventListener('slid.bs.carousel', function (event) {
                // event.to는 0부터 시작하므로 +1
                currentSlideEl.textContent = event.to + 1;
            });
        });
    </script>
</main>
</html>