<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">
<head>
    <title>상품 목록</title>
    <th:block layout:fragment="css">
        <style>
            .content-wrapper {
                max-width: 80%;
                margin: 0 auto;
            }
            h1 {
                color: #0056b3;
                text-align: center;
                margin-bottom: 20px;
            }
            .controls-container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }
            .sort-container .sort-button {
                background-color: #f0f0f0;
                color: #333;
                padding: 8px 15px;
                text-decoration: none;
                border-radius: 5px;
                margin-left: 5px;
                transition: background-color 0.3s ease;
            }
            .sort-container .sort-button:hover {
                background-color: #ddd;
            }
            .sort-container .sort-button.active {
                background-color: #007bff;
                color: white;
            }
            .button-container {
                text-align: right;
            }
            .button {
                display: inline-block;
                background-color: #007bff;
                color: white;
                padding: 10px 20px;
                text-decoration: none;
                border-radius: 5px;
                transition: background-color 0.3s ease;
            }
            .button:hover {
                background-color: #0056b3;
            }
            .product-grid {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 20px;
                margin-bottom: 30px;
            }
            .product-card-link {
                text-decoration: none;
                color: inherit;
                display: block;
            }
            .product-card {
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
                transition: box-shadow 0.3s ease;
            }
            .product-card:hover {
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            .product-card img {
                width: 100%;
                height: 200px;
                object-fit: cover;
                background-color: #f0f0f0; /* Placeholder color */
            }
            .product-info {
                padding: 15px;
            }
            .product-info h3 {
                margin: 0 0 10px 0;
                font-size: 1.1em;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .product-info .price {
                font-weight: bold;
                font-size: 1.2em;
                margin-bottom: 10px;
            }
            .product-info .date {
                font-size: 0.9em;
                color: #888;
            }
            .pagination-container {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }
            .pagination {
                list-style: none;
                padding: 0;
                display: flex;
            }
            .page-item {
                margin: 0 5px;
            }
            .page-link {
                display: block;
                padding: 8px 12px;
                border: 1px solid #ddd;
                text-decoration: none;
                color: #007bff;
                border-radius: 4px;
            }
            .page-item.active .page-link {
                background-color: #007bff;
                color: white;
                border-color: #007bff;
            }
            .page-item.disabled .page-link {
                color: #6c757d;
                pointer-events: none;
                background-color: #fff;
                border-color: #ddd;
            }
        </style>
    </th:block>
</head>
<main layout:fragment="content">
    <div class="content-wrapper">
        <h1>상품 목록</h1>
        <div class="controls-container">
            <div class="sort-container">
                <a th:href="@{/products(sort='latest', keyword=${keyword})}" class="sort-button" th:classappend="${sort == 'latest'} ? 'active'">최신순</a>
                <a th:href="@{/products(sort='views', keyword=${keyword})}" class="sort-button" th:classappend="${sort == 'views'} ? 'active'">조회순</a>
                <a th:href="@{/products(sort='wishlistCount', keyword=${keyword})}" class="sort-button" th:classappend="${sort == 'wishlistCount'} ? 'active'">찜하기순</a>
            </div>
            <div class="button-container" sec:authorize="isAuthenticated()">
                <a th:href="@{/products/new}" class="button">상품 등록</a>
            </div>
        </div>



        <div class="product-grid">
            <!--/* 상품 카드 반복 */-->
            <a th:each="product : ${products}" th:href="@{/products/{id}(id=${product.id})}" class="product-card-link">
                <div class="product-card">
                    <img th:if="${!#lists.isEmpty(product.storedFileNames)}" th:src="@{/images/{filename}(filename=${product.storedFileNames[0]})}" alt="상품 이미지">
                    <img th:unless="${!#lists.isEmpty(product.storedFileNames)}" th:src="@{/image/placeholder.png}" alt="이미지 없음">

                    <div class="product-info">
                        <h3 th:text="${product.title}">상품 제목</h3>
                        <p class="price" th:text="${#numbers.formatInteger(product.price, 0, 'COMMA') + '원'}">가격</p>
                        <p class="date" th:text="${#temporals.format(product.createdAt, 'yyyy-MM-dd HH:mm')}">게시일</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" th:if="${totalPages > 1}">
            <ul class="pagination">
                <!-- Previous Button -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/products(page=${currentPage - 1}, sort=${sort}, keyword=${keyword})}">이전</a>
                </li>

                <!-- Page Numbers -->
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}" th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/products(page=${i}, sort=${sort}, keyword=${keyword})}" th:text="${i}">1</a>
                </li>

                <!-- Next Button -->
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/products(page=${currentPage + 1}, sort=${sort}, keyword=${keyword})}">다음</a>
                </li>
            </ul>
        </div>
    </div>
</main>
</html>
